- binary_sensor:
    - name: "office1_occupied"
      state: >
        {{ states('sensor.office_switches_electric_consumption_w')|float > 5  }}

    - unique_id: unit1_frontroom_occupied
      name: "Living Room Occupancy"
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{ is_state('media_player.50_tcl_roku_tv', 'playing')
              or is_state('media_player.50_tcl_roku_tv', 'on')
              or is_state('binary_sensor.motion_frontroom_home_security_motion_detection', 'on')
              or is_state('binary_sensor.downstairs_person_motion', 'on')
              or is_state('input_select.richard_location', 'Downstairs Livingroom')
              or is_state('input_select.stefanie_location', 'Downstairs Livingroom')
              or is_state('input_select.jenn_location', 'Downstairs Livingroom')
        }}

    - name: Main Floor Occupancy
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{
            is_state('binary_sensor.area_bedroom_occupied', 'on')
          or is_state('binary_sensor.area_bathroom_occupied', 'on')
          or is_state('binary_sensor.living_room_occupancy', 'on')
        }}

    - name: unit2_office_occupancy
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{ (is_state('input_boolean.home_occupied', 'on')
            and is_state('binary_sensor.unit_1_experiment_rcwl0516_movement', 'on')) }}

    - name: area_livingroom_occupancy
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{ 
                is_state('input_select.richard_location', 'Upstairs')
            or is_state('input_select.stefanie_location', 'Upstairs')
            or is_state('input_select.jenn_location', 'Upstairs') 
            or is_state('binary_sensor.upstairs_person_motion', 'on')    
        }}

    - name: first_floor_occupancy
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{ (is_state('input_boolean.home_occupied', 'on')
              and (
                  is_state('binary_sensor.area_bathroom_occupancy', 'on')
                or is_state('binary_sensor.area_livingroom_occupancy', 'on')
                or is_state('input_select.richard_location', 'Upstairs')
                or is_state('input_select.stefanie_location', 'Upstairs')
                or is_state('input_select.jenn_location', 'Upstairs')
              ))
        }}

    - name: unit1_backroom_occupancy
      device_class: "occupancy"
      delay_off:
        minutes: 5
      delay_on:
        seconds: 3
      state: >-
        {{ is_state('binary_sensor.backroom_motion', 'on')
              or is_state('binary_sensor.multisensor_home_security_motion_detection_3', 'on')
        }}

    - unique_id: area_bedroom1_bright
      name: "Area - Bedroom1 Bright"
      device_class: light
      attributes:
        current_illuminance: "{{ (states('sensor.multisensor_bedroom1_illuminance') | float(0)) }}"
        light_state: "{{ states('light.bedroom_lights') }}"
        sun: "{{ states('sun.sun') }}"
      state: "{{ (states('sensor.multisensor_bedroom1_illuminance') | int(0) > states('input_number.area_bedroom_lux_level') | int(0)) and (is_state('sun.sun', 'above_horizon') or is_state('light.bedroom1', 'off')) }}"

    - unique_id: "area_bedroom1_occupied"
      name: Bedroom1 Occupied
      device_class: "occupancy"
      delay_off:
        minutes: 5
      state: >-
        {{ is_state('binary_sensor.multisensor_bedroom1_home_security_motion_detection', 'on' )
            or (is_state('input_boolean.bedtime', 'on'))
        }}

    - unique_id: "sleep_schedule"
      name: Sleep Schedule
      icon: mdi:clock
      state: >
        {% set current_time = now().strftime("%H:%M")  %}
        {% set time_limit_before= states('input_datetime.time_typically_sleeping_start') %}
        {% set time_limit_after = states('input_datetime.time_typically_sleeping_start') %}

        {% if time_limit_before == none and time_limit_after == none %}
        true
        {% endif %}

        {% if time_limit_before != none and time_limit_after == none %}
        {% set current_time_is_before_limit = current_time < time_limit_before  %}
        {{ current_time_is_before_limit }}
        {% elif time_limit_before == none and time_limit_after != none %}
        {% set current_time_is_after_limit = current_time > time_limit_after  %}
        {{ current_time_is_after_limit }}
        {% endif %}

        {% if time_limit_before != none and time_limit_after != none %}
        {% set before_limit_is_tomorrow = time_limit_before < time_limit_after  %}
        {% set current_time_is_before_limit = current_time < time_limit_before  %}
        {% set current_time_is_after_limit = current_time > time_limit_after  %}
        {% set time_window_spans_midnight = time_limit_after > time_limit_before  %}
          {% if time_window_spans_midnight != none and time_window_spans_midnight and before_limit_is_tomorrow %}
          {{ current_time_is_after_limit or current_time_is_before_limit }}
          {% elif time_window_spans_midnight != none and not time_window_spans_midnight %}
          {{ current_time_is_before_limit and current_time_is_after_limit }}
          {% endif %}
        {% endif %}
